# SCIGA

## Introdution

SCIGA written in Perl is a toolkit for 10X single cell immunoglobulin repertoires analysis. It uses raw reads or output of Cellranger as input and performs reads quality control, immunoglobulin sequence assembly, sequence annotation, heavy- and light- chain pairing, computing statistics and visualizing. Full detail of SCIGA algorithm can be found in our paper.  

## Pre-requisites

Before installing and using SCIGA, users need to install the following tools:

IgBlast (>=1.15.0) - https://ftp.ncbi.nih.gov/blast/executables/igblast/release

Blast (>=2.9.0) - ftp://ftp.ncbi.nlm.nih.gov/blast/executables/blast+/

R (optional) – For visualizing the results

ggplot2 (optional) – The R package


## Installation

wget 

tar zvxf

cd 

`vi path` and set the path of IgBlast and Blast
  

## Basic usage

### For each sample, run SCIGA as below when using raw reads as input:
```
sciga -fq1 <mate1.fq.gz> -fq2 <mate2.fq.gz> -outdir <output directory> -species <string> -draw T
  
-fq1        Fastq file of first mates containing barcode. Multiple files can be separated by comma

-fq2        Fastq file of second mates. Multiple files can be separated by comma

-outdir     Create and write output to this directory

-species    The species of query sequence: 'human', 'mouse', 'rat'

-draw       Whether draw figure of result. Default = 'F'
```
To see the full manual, run `sciga -help`.

### For each sample, run SCIGA as below when using output of Cellranger as input:
```
sciga-cr -contig <*contig.fasta> -annotate <*contig_annotations.csv> -outdir <output directory> -species <string> -draw T
  
-contig      The file 'filtered_contig.fasta' or 'all_contig.fasta' generated by Cellranger

-annotate    The file 'filtered_contig_annotations.csv' or 'all_contig_annotations.csv' generated by Cellranger

-outdir      Create and write result to this directory

-species     The species of query sequence: 'human', 'mouse', 'rat'
```
To see the full manual, run `sciga-cr -help`.

### For integrating the results of multiple samples, users can run SCIGA as below:

sciga-merge -in <input directories> -out <output directory>
  
-in      The directories containing results generating by SCIGA program, multiple paths need to be separated by ','

-out     Create and write result to this directory

To see the full manual, run `sciga-merge -help`.

## Optional usage

### Choosing cell detecting method

In the 10X system, the majority (~90 – 99%) of generated Gel Beads-in-emulsion (GEMs) contains no cell. SCIGA provides two methods for detecting “real” cells based on the reads count of cells: 

1. SCIGA constructs a curve graph of barcodes rank corresponding to their reads count in the form of logarithm. A cutoff is set at the point which slope is minimal and barcodes which reads count exceed cutoff are considered as “real” cells. This method is suitable for samples having large difference of reads count between “real” cells and background. 

2. For another method, barcodes are considered as “real” cells when their reads count exceed an arbitrary cutoff setting by user. 

Users can get more detail about the methods in our paper. The cell detecting method can be set with “sciga -method”. To help choosing the method, users can run the command as below:
```
sciga-curve -fq1 <mate1.fq.gz> -out <outfile>

-fq1    #1 mates of paired fastq file which contains barcode information

-out    The prefix of output figure
 ``` 
To see the full manual, run `sciga-curve -help`.
 
This command generates a curve graph of barcodes rank corresponding to their reads count in the form of logarithm. Based on the graph, users can set the cell detecting method or cutoff of reads count in a cell.

### Using external V(D)JC reference database

SCIGA has provided the V(D)JC reference database of human, mouse and rat. Users could run the program by only setting the species, do not need to set the path of reference database. We strongly recommend using our reference database. However, if users need to use external database, users could make index as below:
```
bin/sciga-index -vgene <v.fa> -dgene <d.fa> -jgene <j.fa> -cgene <c.fa> -outdir <out directory>
  
-vgene <fastafile>    Uncompressed fasta file of V gene reference
  
-dgene <fastafile>    Uncompressed fasta file of D gene reference
  
-jgene <fastafile>    Uncompressed fasta file of J gene reference
  
-cgene <fastafile>    Uncompressed fasta file of C gene reference
  
-outdir <path>        Output directory
```
Before making index, the titles of sequences in the fasta file of V(D)JC reference should be edited to be simple genes name, eg. IGHV1-11*01. In addition, users need to set up the internal data and optional file of IgBlast. See https://ncbi.github.io/igblast/cook/How-to-set-up.html.

After making index, users could run program as below:
```
sciga -fq1 <mate1.fq.gz> -fq2 <mate2.fq.gz> -outdir <output directory> -index <index directory> -species <string> -draw T
```
or
```
sciga-cr -contig <*contig.fasta> -annotate <*contig_annotations.csv> -outdir <output directory> -index <index directory> -species <string> -draw T
```

